@{
    var nowShowing = ViewBag.NowShowing as List<BusinessObjects.Models.Movie>;
    var upcoming = ViewBag.Upcoming as List<BusinessObjects.Models.Movie>;
}

<section class="movies-section container">
    <div class="section-header w-100">
        <h5 class="mb-0 border-start border-5 border-primary ps-2" style="border-left-color: #D84040 !important;">
            PHIM
        </h5>
        <ul class="nav nav-tabs" id="movieTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="now-tab" data-bs-toggle="tab" data-bs-target="#now" type="button"
                        role="tab" aria-controls="now" aria-selected="true">
                    Đang chiếu
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="soon-tab" data-bs-toggle="tab" data-bs-target="#soon" type="button" role="tab"
                        aria-controls="soon" aria-selected="false">
                    Sắp chiếu
                </button>
            </li>
        </ul>
    </div>

    <div class="tab-content mt-4">
        <!-- Tab Đang chiếu -->
        <div class="tab-pane fade show active" id="now" role="tabpanel" aria-labelledby="now-tab">
            <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-5 g-4">
                @foreach (var movie in nowShowing ?? Enumerable.Empty<BusinessObjects.Models.Movie>())
                {
                    <div class="col">
                        <a asp-controller="MoviesUser" asp-action="DetailFilm" asp-route-id="@movie.MovieId" class="d-block h-100 text-decoration-none">
                            <div class="card movie-card h-100">
                                <div class="poster-container position-relative overflow-hidden rounded-2">
                                    <img src="@movie.PosterUrl" class="img-fluid w-100" style="height:350px; object-fit:cover;" alt="@movie.Title" />
                                    <div class="overlay position-absolute top-0 start-0 w-100 h-100 d-flex flex-column justify-content-center align-items-center">
                                        <button class="btn btn-tickett mb-2">Mua vé</button>
                                        <button class="btn btn-outline-light">▶ Trailer</button>
                                    </div>
                                    <span class="badge-rating">@movie.Rating</span>
                                    <span class="badge-age">@movie.AgeRating</span>
                                </div>
                                <div class="card-body text-center">
                                    <h6 class="card-title mb-0">@movie.Title</h6>
                                </div>
                            </div>
                        </a>
                    </div>
                }
            </div>
        </div>

        <!-- Tab Sắp chiếu -->
        <div class="tab-pane fade" id="soon" role="tabpanel" aria-labelledby="soon-tab">
            <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-5 g-4">
                @foreach (var movie in upcoming ?? Enumerable.Empty<BusinessObjects.Models.Movie>())
                {
                    <div class="col">
                        <a asp-controller="MoviesUser" asp-action="DetailFilm" asp-route-id="@movie.MovieId" class="d-block h-100 text-decoration-none">
                            <div class="card movie-card h-100">
                                <div class="poster-container position-relative overflow-hidden rounded-2">
                                    <img src="@movie.PosterUrl" class="img-fluid w-100" style="height:350px; object-fit:cover;" alt="@movie.Title" />
                                    <div class="overlay position-absolute top-0 start-0 w-100 h-100 d-flex flex-column justify-content-center align-items-center">
                                        <button class="btn btn-tickett mb-2">Mua vé</button>
                                        <button class="btn btn-outline-light">▶ Trailer</button>
                                    </div>
                                    <span class="badge-rating">@movie.Rating</span>
                                    <span class="badge-age">@movie.AgeRating</span>
                                </div>
                                <div class="card-body text-center">
                                    <h6 class="card-title mb-0">@movie.Title</h6>
                                </div>
                            </div>
                        </a>
                    </div>
                }
            </div>
        </div>
    </div>
</section>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />
<script>
    window.addEventListener('DOMContentLoaded', () => {
      // 1. Lấy fragment (VD: "#now", "#soon", "#imax")
      const hash = location.hash;
      if (!hash) return;

      // 2. Tìm nút tab tương ứng
      const btn = document.querySelector(`#movieTab button[data-bs-target="${hash}"]`);
      if (!btn) return;

      // 3. Dùng API của Bootstrap Tab để show tab đó
      new bootstrap.Tab(btn).show();
    });
</script>
@section Scripts {
    @await Html.PartialAsync("_ValidationScriptsPartial")
}
@section Styles {
    <link rel="stylesheet" href="~/css/ListFilm.css">
}